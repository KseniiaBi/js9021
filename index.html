<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1"> 

	<style>
		canvas{
			width: 500px;
			height: 300px;
			border: 1px solid #e2e2e2;
		}

	</style>
	
</head>
<body>


	<canvas width="500" height="300"></canvas>


<script>
	const canvas = document.querySelector('canvas');
	let cWidth = canvas.offsetWidth;
	let cHeight = canvas.offsetHeight;
	let ctx = canvas.getContext('2d');

	let balls = [];
	let maxRad = 15;
	let maxCount = 10;
	let d_y = 3;
	let d_x = 3;
	let interval;


	function update(){
		clear();
		///
		balls.forEach(item =>drawBall(item));
	}

	function createColor(){
		let r = Math.floor(Math.random()*255);
		let g = Math.floor(Math.random()*255);
		let b = Math.floor(Math.random()*255);
		let color = `rgb(${r},${g},${b})`;
		return color
	}

	function createBall(){
		if(balls.length < maxCount){
			let rad = Math.random()*maxRad + 5;
			let ball = {
				r: rad,
				col: createColor(),
				pos_x: 0,
				pos_y: 0,
				d_y: 3,
				d_x: 3,
				balldir: true //'right'
			};

			balls.push(ball);
		}
		else{
			clearInterval(interval);
		}
	}

	function drawBall(ball){
		ctx.beginPath();
	    ctx.arc(ball.pos_x, ball.pos_y, ball.r, 0, Math.PI * 2, true);
	    ctx.closePath();
	    ctx.fillStyle = ball.col;
	    ctx.fill();

	    moveBall(ball);
	}


	function moveBall(ball){

		ball.pos_x += ball.d_x;
		ball.pos_y += ball.d_y;

		if(ball.pos_x + ball.r > cWidth || ball.pos_x + ball.r < ball.r){
			ball.d_x = -ball.d_x;
			ball.balldir = ball.d_x > 0;
			ball.col = createColor();
		}
		if(ball.pos_y + ball.r > cHeight || ball.pos_y + ball.r < ball.r){
			ball.d_y = -ball.d_y;
			ball.col = createColor();
		}


		let ball_x = ball.pos_x + ball.r;
		let ball_y = ball.pos_y + ball.r;

		balls.forEach(item => {
			if(item != ball && item.balldir != ball.balldir){
				if( item.pos_x + item.r <= ball_x && item.pos_y + item.r <= ball_y ){
					ball.d_y = -ball.d_y;
					ball.d_x = -ball.d_x;
					item.d_y = -item.d_y;
					item.d_x = -item.d_x;
					ball.balldir = !ball.balldir;
					item.balldir = !item.balldir;
				}
			}
		});

	}

	function clear(){
		ctx.clearRect(0,0, cWidth, cHeight);
	}

	interval = setInterval(createBall, 1000);

	setInterval(update, 20);



</script>

</body>
</html>