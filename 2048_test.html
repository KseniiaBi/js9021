<!DOCTYPE html>
<html lang="en">
	<head>
		<title>2048 test</title> 
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1"> 
		<style>
		</style>
	</head>
	<body>
		<script>
			let which = 0;
			let wIndex = 0;
			let mem = [];
			let cord = [];
			let answer;
			let arr1 = [0,0,0,0];
			let arr2 = [0,2,0,4];
			let arr3 = [0,2,0,4];
			let arr4 = [0,2,0,4];
			let arrAll = [arr1,arr2,arr3,arr4];
			print();
			function print(){
				for (let i =0;i<arrAll.length;i++){
					console.log(arrAll[i]);
				}
			}
			function swipeAll(diraction){
				if (diraction==1){
					for (let i=0;i<arrAll.length;i++){
						for (let j=0;j<arrAll[i].length;j++){
							swipeOne(i,j,diraction);
						}
					}
				}
				else if (diraction==2) {
					for (let i=0;i<arrAll.length;i++){
						for (let j=arrAll[i].length-1;j>=0;j--){
							swipeOne(i,j,diraction);
						}
					}
				}
				else if (diraction==3) {
					for (let i=arrAll.length-1;i>=0;i--){
						for (let j=0;j<arrAll[i].length;j++){
							swipeOne(i,j,diraction);
						}
					}
				}
				else if (diraction==4) {
					for (let i=0;i<arrAll.length;i++){
						for (let j=0;j<arrAll[i].length;j++){
							swipeOne(i,j,diraction);
						}
					}
				}
			}
			function swipeOne(x,y,diraction){
				arrWhere = swipeWhere(x,y,diraction);
				let mid = arrAll[x][y];
				arrAll[x][y]=0;
				arrAll[arrWhere[0]][arrWhere[1]]=mid;
			}
			function swipeWhere(x,y,diraction){
				cord = [x,y];
				if (diraction==1){bestCordUp(x,y)}
				else if (diraction==2) {bestCordRight(x,y)}
				else if (diraction==3) {bestCordDown(x,y)}
				else if (diraction==4) {bestCordLeft(x,y)}
				return cord;
			}
			function bestCordDown(x,y){
				if (x+1==4){return cord[0]=x}
				if (arrAll[x+1][y]==0){bestCordDown(x+1,y)}
				else cord[0]=x;
			}
			function bestCordUp(x,y){
				if (x-1<0){return cord[0]=x;}
				if (arrAll[x-1][y]==0){bestCordUp(x-1,y)}
				else cord[0]=x;
			}
			function bestCordLeft(x,y){
				if (arrAll[x][y-1]==0){bestCordLeft(x,y-1)}
				else cord[1]=y;
			}
			function bestCordRight(x,y){
				if (arrAll[x][y+1]==0){bestCordRight(x,y+1)}
				else cord[1]=y;
			}
			function summing(diraction){
				which=0;
				wIndex = 0;
				if (diraction==1){
					for (let i=1;i<arrAll.length;i++){
						for (let j=0;j<arrAll[i].length;j++){
							if (arrAll[i][j]!=0){sumWhichWhere(diraction,i,j)}
						}
					}
				}
				else if (diraction==2) {
					for (let i=0;i<arrAll.length;i++){
						for (let j=arrAll[i].length-2;j>=0;j--){
							if (arrAll[i][j]!=0){sumWhichWhere(diraction,i,j)}
						}
					}
				}
				else if (diraction==3) {
					for (let i=arrAll.length-2;i>=0;i--){
						for (let j=0;j<arrAll[i].length;j++){
							if (arrAll[i][j]!=0){sumWhichWhere(diraction,i,j)}
						}
					}
				}
				else if (diraction==4) {
					for (let i=0;i<arrAll.length;i++){
						for (let j=1;j<arrAll[i].length;j++){
							if (arrAll[i][j]!=0){sumWhichWhere(diraction,i,j)}
						}
					}
				}
				console.log(which);
				if (Array.isArray(which)){sumNeeded()}
			}
			function sumNeeded(){
				for (let i=0;i<which.length;i++){
					arrAll[which[i][0][0]][which[i][0][1]]=0;
					arrAll[which[i][1][0]][which[i][1][1]]*=2;
				}
			}
			function sumWhichWhere(diraction,i,j){
				if (diraction==1){
					for (let k=1; k<=i;k++){
						if (arrAll[i-k][j]==0){continue}
						else if (arrAll[i-k][j]==arrAll[i][j]){
							if (!Array.isArray(which)){ which=[]}
							which[wIndex]=[[i,j],[i-k,j]];
							wIndex+=1;
						}
						else if ((arrAll[i-k][j]!=arrAll[i][j])&&(arrAll[i-k][j]!=0)){return}
					}
				}
				if (diraction==3){
					for (let k=1; k<arrAll.length-i;k++){
						if (arrAll[i+k][j]==0){continue}
						else if (arrAll[i+k][j]==arrAll[i][j]){
							if (!Array.isArray(which)){ which=[]}
							which[wIndex]=[[i,j],[i+k,j]];
							wIndex+=1;
						}
						else if ((arrAll[i+k][j]!=arrAll[i][j])&&(arrAll[i+k][j]!=0)){return}
					}
				}
				if (diraction==2){
					for (let k=1; k<arrAll[i].length-j;k++){
						if (arrAll[i][j+k]==0){continue}
						else if (arrAll[i][j+k]==arrAll[i][j]){
							if (!Array.isArray(which)){ which=[]}
							which[wIndex]=[[i,j],[i,j+k]];
							wIndex+=1;
						}
						else if ((arrAll[i][j+k]!=arrAll[i][j])&&(arrAll[i][j+k]!=0)){return}
					}
				}
				if (diraction==4){
					for (let k=1; k<=j;k++){
						if (arrAll[i][j-k]==0){continue}
						else if (arrAll[i][j-k]==arrAll[i][j]){
							if (!Array.isArray(which)){ which=[]}
							which[wIndex]=[[i,j],[i,j-k]];
							wIndex+=1;
						}
						else if ((arrAll[i][j-k]!=arrAll[i][j])&&(arrAll[i][j]-k!=0)){return}
					}
				}
			}
			function getRandomInt(){
				return Math.floor(Math.random() * 4); 
			}
			function isFull(){
				answer = false;
				arrAll.forEach(checkZero)
				if (answer){return false}
				else return true
			}
			function checkZero(currentValue, index, arr){
				currentValue.forEach((item)=>{if (item==0){answer=true}})
			}
			function isMoved(){
				let main = ``;
				let copy = ``;
				for (let i=0;i<arrAll.length;i++){
					main += arrAll[i].toString();
					copy += mem[i].toString();
				}
				if (main==copy){return false}
				else return true
			}
			function memory(){
				mem = [[...arr1],[...arr2],[...arr3],[...arr4]];
			}
			function randomTwo(){
				if ((isFull()==false)&&(isMoved()==true)){
					let two=[getRandomInt(),getRandomInt()];
					if (arrAll[two[0]][two[1]]==0){return arrAll[two[0]][two[1]]=2}
					else randomTwo();
				}
				else return
			}
			function swipeDown(){
				memory();
				summing(3);
				console.clear();
				swipeAll(3);
				randomTwo();
				print();
			}
			function swipeLeft(){
				memory();
				summing(4);
				console.clear();
				swipeAll(4);
				randomTwo();
				print();
			}
			function swipeUp(){
				memory();
				summing(1);
				console.clear();
				swipeAll(1);
				randomTwo();
				print();
			}
			function swipeRight(){
				memory();
				summing(2);
				console.clear();
				swipeAll(2);
				randomTwo();
				print();
			}
			document.addEventListener ('keydown', function (event) {
				if (event.repeat) return;  
				else {
					if (event.key=='ArrowLeft'){swipeLeft()}
					if (event.key=='ArrowRight'){swipeRight()}
					if (event.key=='ArrowUp'){swipeUp()}
					if (event.key=='ArrowDown'){swipeDown()}
					if (event.key=='1'){summing(1);print();}
					if (event.key=='2'){summing(2);print();}
					if (event.key=='3'){summing(3);print();}
					if (event.key=='4'){summing(4);print();}
					if (event.code==`Space`){console.clear();}
				}
			});
		</script>
	</body>
</html>